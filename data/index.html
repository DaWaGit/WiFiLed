<!--
  ColorPicker see: https://github.com/fujaru/jquery-wheelcolorpicker
  ESP32 WebServer: https://randomnerdtutorials.com/esp32-web-server-spiffs-spi-flash-file-system/

  Hamburger Menue: https://alvarotrigo.com/blog/hamburger-menu-css/
                  https://codepen.io/erikterwan/pen/EVzeRP
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>WiFiLed-`id`</title>
    <meta name="viewport" content="width=device-width, initial-scale=.9">
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <script type="text/javascript" src="jquery-3.4.1.slim.min.js"></script>
    <script type="text/javascript" src="jquery.wheelcolorpicker.min.js"></script>
    <link type="text/css" rel="stylesheet" href="wheelcolorpicker.css" />
    <link type="text/css" rel="stylesheet" href="ToggleSwitch.css" />
    <style>
      body, html{
        height:100%;
        width:100%;
      }
      body {
        background-color:#333333;
        color: #ffffff;
        font-family: Arial;
        margin-top:10px;
        margin-bottom:10px;
        margin-left:3px;
        margin-right:3px;
      }
      .device-name {
        font-family: Arial;
        font-size  : 32px;
        font-weight: bold;
        text-align: left;
        color: #ffffff;
        width: 100%;
        cursor: pointer;
      }
      .value-name {
        font-family: Arial;
        font-size  : 24px;
        text-align: left;
        color: #888888;
        height: 40px;
      }
      .value {
        font-family: monospace, Courier, 'Courier New';
        font-size  : 24px;
        text-align: right;
        color: #888888;
        height: 40px;
      }
      .config1 {
        width: 350px;
        /* width: 98%; */
        background-color: #222222;
        border-radius: 4px;
        border: solid 1px #aaa;
        padding: 5px;
        z-index: 1001;
      }
      .config2 {
        border-top-color: #070707;
        border-left-color: #070707;
        border-right-color: #aaa;
        border-bottom-color: #aaa;
        box-shadow: -1px -1px 1px #000;
      }
      .custom-select {
        font-family: Arial;
        font-size  : 24px;
        text-align: left;
        height: 40px;
      }
      .custom-select select {
        background-color: #888888;
        font-family: Arial;
        font-size  : 24px;
        text-align: left;
        width: 100%;
      }
      input {
        background-color: #888888;
        font-family: Arial;
        font-size  : 24px;
        text-align: left;
        width: 90%;
      }
      .dayNight {
        position:absolute;
        top:0px;
        left:0px;
        width:32px;
        z-index: 2000;
      }
    </style>
    <script type="text/javascript">
      var url = "`wsUrl`";
      var boSendToDevice = true;
      var hue = 0;
      var sat = 0;
      var bri = 0;
      var day = 0;
      var reconnectTimer;

      //#########################################
      // This is called when the page finishes loading
      function init() {
        // enable the change event listener
        document.getElementById('select').addEventListener('change', function handleChange(event) {
          selectElement(event.target.value);
        });
        document.getElementById('colorMode').addEventListener('change', function handleChange(event) {
          doSend("colorMode:" + event.target.value);
        });
        // select the initially elements
        selectElement(document.getElementById('select').value);
        // Connect to WebSocket server
        if (!url.includes('wsUrl')) {
          wsConnect(url);
        }
        $("#sun").detach().appendTo("#colorSelector");  // move icon to parent colorSelector
        $("#moon").detach().appendTo("#colorSelector"); // move icon to parent colorSelector
      }
      //#########################################
      // select an element: color/wifi/...
      function selectElement(element) {
        document.getElementById('color').style.display = element === 'color' ? 'block' : 'none';
        document.getElementById('wifi').style.display  = element === 'wifi'  ? 'block' : 'none';
        document.getElementById('time').style.display  = element === 'time'  ? 'block' : 'none';
        document.getElementById('led').style.display   = element === 'led'   ? 'block' : 'none';
        document.getElementById('setup').style.display = element === 'setup' ? 'block' : 'none';
      }
      //#########################################
      // Call this to connect to the WebSocket server
      function wsConnect(url) {
        console.log("[WebSocket] Try a connection to " + url);
        // Connect to WebSocket server
        websocket = new WebSocket(url);
        // Assign callbacks
        websocket.onopen    = function (evt) { onOpen(evt) };
        websocket.onclose   = function (evt) { onClose(evt) };
        websocket.onmessage = function (evt) { onMessage(evt) };
        websocket.onerror   = function (evt) { onError(evt) };
      }
      //#########################################
      // Called when a WebSocket connection is established with the server
      function onOpen(evt) {
        // Log connection state
        console.log("[WebSocket] Connected");
        // clear timeout timer
        clearInterval(reconnectTimer);
      }
      //#########################################
      // Called when the WebSocket connection is closed
      function onClose(evt) {
        // Log disconnection state
        console.log("[WebSocket] Disconnected");
        // try to reconnect after a few seconds
        reconnectTimer = setTimeout(function () { wsConnect(url) }, 1000);
      }
      //#########################################
      // Called when a message is received from the server
      function onMessage(evt) {
        // Print out our received message
        console.log("[WebSocket] Rx: " + evt.data);
        //-----------------------------
        // new color
        var result = evt.data.match(/^sw:(\d+)h:(\d+)s:(\d+)b:(\d+)bDay:(\d+)bNight:(\d+)Day:(\d+)$/i);
        if (result) {
          boSendToDevice = false;
          if (Number(result[1])) {
            $("#StripeSwitch").prop('checked', true); // turn html switch on
          } else {
            $("#StripeSwitch").prop('checked', false); // turn html switch off
          }
          hue = Number(result[2]) / 0xffff;
          sat = Number(result[3]) / 0xff;
          bri = Number(result[4]) / 0xff;
          $('#color-block').wheelColorPicker(
            'setColor',
            {
              h: hue,
              s: sat,
              v: bri
            }
          );
          $("#bDay").prop('value', Number(result[5]));   // set day brightness
          $("#bNight").prop('value', Number(result[6])); // set night brigntness
          day = Number(result[7]);
          if (day) {
            $('#sun').css('visibility', 'visible');
            $('#moon').css('visibility', 'hidden');
          } else {
            $('#sun').css('visibility', 'hidden');
            $('#moon').css('visibility', 'visible');
          }
          return;
        }
        //-----------------------------
        // new colorMode or new speed
        result = evt.data.match(/^colorMode:(\d+)speed:(\d+)$/i);
        if (result) {
          $("#colorMode").prop('value', Number(result[1]));  // set colorMode
          $("#speedValue").prop('value', Number(result[2])); // set speed
          $(".speedValTxt").text(Math.round((100*Number(result[2]))/255)+"%");
          return;
        }
        //-----------------------------
        // enable/disable distance sensor
        result = evt.data.match(/^dSens:(\d+)$/i);
        if (result) {
          boSendToDevice = false;
          if (Number(result[1])) {
            $("#DistanceSensorSwitch").prop('checked', true);
            document.getElementById('calibrationBtn').disabled = false;
          } else {
            $("#DistanceSensorSwitch").prop('checked', false);
            document.getElementById('calibrationBtn').disabled = true;
          }
          return;
        }
        //-----------------------------
        // enable/disable distance sensor
        result = evt.data.match(/^mSens:(\d+)$/i);
        if (result) {
          boSendToDevice = false;
          if (Number(result[1])) {
            $("#MotionSensorSwitch").prop('checked', true);
            document.getElementById('offDelay').disabled = false;
          } else {
            $("#MotionSensorSwitch").prop('checked', false);
            document.getElementById('offDelay').disabled = true;
          }
          return;
        }
/*
        //-----------------------------
        // new brightness
        result = evt.data.match(/^setB:(\d+)bDay:(\d+)bNight(\d+)$/i);
        if (result) {
          boSendToDevice = false;
          $('#color-block').wheelColorPicker(
            'setColor',
            {
              h: $('#color-block').wheelColorPicker('color').h,
              s: $('#color-block').wheelColorPicker('color').s,
              v: Number(result[1]) / 0xff
            }
          );
          $("#bDay").prop('value', Number(result[2]));   // set day brightness
          $("#bNight").prop('value', Number(result[3])); // set night brigntness
          return;
        }
*/
      }
      //#########################################
      // Called when a WebSocket error occurs
      function onError(evt) {
        console.log("[WebSocket] Error: " + evt.data);
      }
      //#########################################
      // Sends a message to the server (and prints it to the console)
      function doSend(message) {
        console.log("[WebSocket] Tx: " + message);
        if (typeof websocket != "undefined") { websocket.send(message); }
      }
      //#########################################
      function toggleLedStripe() {
        if ($("#StripeSwitch").is(':checked')) {
          doSend("on");
        } else {
          doSend("off");
        }
      }
      //#########################################
      function toggleDistanceSensor() {
        if ($("#DistanceSensorSwitch").is(':checked')) {
          doSend("dSens:1");
          document.getElementById('calibrationBtn').disabled = false;
        } else {
          doSend("dSens:0");
          document.getElementById('calibrationBtn').disabled = true;
        }
      }
      //#########################################
      function toggleMotionSensor() {
        if ($("#MotionSensorSwitch").is(':checked')) {
          doSend("mSens:1");
          document.getElementById('offDelay').disabled = false;
        } else {
          doSend("mSens:0");
          document.getElementById('offDelay').disabled = true;
        }
      }
      //#########################################
      function toggleTitle() {
        if ($("#StripeSwitch").is(':checked')) {
          $("#StripeSwitch").prop('checked', false); // turn html switch on
          doSend("off");
        } else {
          $("#StripeSwitch").prop('checked', true); // turn html switch on
          doSend("on");
        }
      }
      //#########################################
      function toggleBrightness() {
        bri = (day ? Number(document.getElementById("bDay").value) : Number(document.getElementById("bNight").value)) / 0xff;
        $('#color-block').wheelColorPicker(
          'setColor',
          {
            h: $('#color-block').wheelColorPicker('color').h,
            s: $('#color-block').wheelColorPicker('color').s,
            v: bri
          }
        );
      }
      //#########################################
      // Call the init function as soon as the page loads
      window.addEventListener("load", init, false);
    </script>
  </head>
<!--##########################################-->
  <body>
    <table style="width:100%;height:100%;border-collapse:collapse;">
      <tr><td align="center" style="vertical-align: top;">
        <div class="config1 config2" style="display: inline-block;"">
          <table style="width:100%; height: 30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="device-name"><span onclick="toggleTitle()">WiFiLed-`id`</span></td>
                <td><label class="switch"><input id="StripeSwitch" type="checkbox" onChange="toggleLedStripe()"><span class="slider round"></span></label></td>
              </tr>
            </tbody>
          </table>
        </div>
        <br>
        <div id="colorSelector" style="width:360px;position:relative;">
          <input id="color-block" type="text" value="#ffffff" data-wheelcolorpicker data-wcp-format="css"
            data-wcp-layout="block" data-wcp-sliders="wv" data-wcp-cssClass="config1 config2" data-wcp-autoResize="false" />
        </div>
        <div class="config1 config2" style="display: inline-block;"">
          <table style=" width:100%; height: 30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="custom-select">
                  <select name="select" id="select" autocomplete="off">
                    <option value="color" selected="selected">Color mode</option>
                    <option value="wifi">WiFi setup</option>
                    <option value="time">Time setup</option>
                    <option value="led">LED setup</option>
                    <option value="setup">Global Setup</option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="color" class="config1 config2" style="display: inline-block;"">
          <table style="width:100%; height: 30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="custom-select" colspan="2">
                  <select name="colorMode" id="colorMode">
                    <option value='0'>Monochome</option>
                    <option value='1'>Rainbow</option>
                    <option value='2'>Random</option>
                    <option value='3'>MovingPoint</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td class="value-name" width="150px">Speed <span style="float:right" class="speedValTxt"></span></td><td class="value">
                  <input id="speedValue" type="range" min="0" max="255" step="1.0" value="`speed`"
                  onChange='doSend("speed:"+document.getElementById("speedValue").value); $(".speedValTxt").text(Math.round((100*document.getElementById("speedValue").value)/255)+"%");'>
                </td>
              </tr>
              <tr>
                <td class="value-name">RGB</td><td class="value"><span class="rgbValue"></span></td>
              </tr>
              <tr>
                <td class="value-name">Hue</td><td class="value"><span class="hValue"></span></td>
              </tr>
              <tr>
                <td class="value-name">Saturation</td><td class="value"><span class="sValue"></span></td style="text-align: right;">
              </tr>
              <tr>
                <td class="value-name">Brightness</td><td class="value"><span class="bValue"></span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="wifi" class="config1 config2" style="display: inline-block;"">
          <table style=" width:100%; height:30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="value-name">SSID</td>
                <td class="value"><input type="text" maxlength="49" placeholder="WiFi SSID" id="ssidValue" value="`ssid`"></td>
              </tr>
              <tr>
                <td class="value-name">Password</td>
                <td class="value"><input type="password" maxlength="49" placeholder="WiFi password" id="pwdValue" value="`pwd`"></td>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value">&nbsp;</td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value">&nbsp;</td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value">&nbsp;</td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value"><button class="btn"onclick='doSend("Ssid:"+document.getElementById("ssidValue").value+"Pwd:"+document.getElementById("pwdValue").value); alert("WiFiLed-`id` will now restart to connect to the configured SSID!");'>Success</button></td>
              </tr>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="time" class="config1 config2" style="display: inline-block;"">
          <table style=" width:100%; height:30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="value-name" width="135px">Time Zone</td>
                <td class="custom-select">
                  <select name="timeZone" id="timeZone" autocomplete="off">
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Amsterdam</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Andorra</option>
                    <option value="<+04>-4">Europe/Astrakhan</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Athens</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Belgrade</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3" selected="selected">Europe/Berlin</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Bratislava</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Brussels</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Bucharest</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Budapest</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Busingen</option>
                    <option value="EET-2EEST,M3.5.0,M10.5.0/3">Europe/Chisinau</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Copenhagen</option>
                    <option value="IST-1GMT0,M10.5.0,M3.5.0/1">Europe/Dublin</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Gibraltar</option>
                    <option value="GMT0BST,M3.5.0/1,M10.5.0">Europe/Guernsey</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Helsinki</option>
                    <option value="GMT0BST,M3.5.0/1,M10.5.0">Europe/Isle_of_Man</option>
                    <option value="<+03>-3">Europe/Istanbul</option>
                    <option value="GMT0BST,M3.5.0/1,M10.5.0">Europe/Jersey</option>
                    <option value="EET-2">Europe/Kaliningrad</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Kiev</option>
                    <option value="<+03>-3">Europe/Kirov</option>
                    <option value="WET0WEST,M3.5.0/1,M10.5.0">Europe/Lisbon</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Ljubljana</option>
                    <option value="GMT0BST,M3.5.0/1,M10.5.0">Europe/London</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Luxembourg</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Madrid</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Malta</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Mariehamn</option>
                    <option value="<+03>-3">Europe/Minsk</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Monaco</option>
                    <option value="MSK-3">Europe/Moscow</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Oslo</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Paris</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Podgorica</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Prague</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Riga</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Rome</option>
                    <option value="<+04>-4">Europe/Samara</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/San_Marino</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Sarajevo</option>
                    <option value="<+04>-4">Europe/Saratov</option>
                    <option value="MSK-3">Europe/Simferopol</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Skopje</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Sofia</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Stockholm</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Tallinn</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Tirane</option>
                    <option value="<+04>-4">Europe/Ulyanovsk</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Uzhgorod</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Vaduz</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Vatican</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Vienna</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Vilnius</option>
                    <option value="<+03>-3">Europe/Volgograd</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Warsaw</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Zagreb</option>
                    <option value="EET-2EEST,M3.5.0/3,M10.5.0/4">Europe/Zaporozhye</option>
                    <option value="CET-1CEST,M3.5.0,M10.5.0/3">Europe/Zurich</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td class="value-name">Server1</td>
                <td class="value"><input type="text" placeholder="e.g. ptbtime1.ptb.de" id="ntpServer1" name="ntpServer1" value=""></td>
              <tr>
                <td class="value-name">Server2</td>
                <td class="value"><input type="text" placeholder="e.g. ptbtime2.ptb.de" id="ntpServer2" name="ntpServer2" value=""></td>
              </tr>
              <tr>
                <td class="value-name">Latitude</td>
                <td class="value"><input type="number" placeholder="12.345" id="latitude" name="latitude" value=""></td>
              </tr>
              <tr>
                <td class="value-name">Longitude</td>
                <td class="value"><input type="number" placeholder="67.89" id="longitude" name="longitude" value=""></td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value"><button class="btn" onclick=''>Success</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="led" class="config1 config2" style="display: inline-block;"">
          <table style=" width:100%; height:30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="value-name" width="125px">LED's</td>
                <td class="value"><input type="number" min="1" placeholder="number of LED's 1..300" id="ledCount" name="ledCount" value="`ledCount`"></td>
              </tr>
              <tr>
                <td class="value-name">bright. min</td>
                <td class="value"><input type="number" min="0" max="255" placeholder="0..255" id="bMin" name="bMin" value="`bMin`"></td>
              <tr>
                <td class="value-name">bright. max</td>
                <td class="value"><input type="number" min="0" max="255" placeholder="0..255" id="bMax" name="bMax" value="`bMax`"></td>
              </tr>
              <tr>
                <td class="value-name">bright. <img src="sun.svg" height="32px" style="vertical-align:middle; filter: invert(50%) sepia(50%) saturate(0%) hue-rotate(0deg) brightness(87%) contrast(156%);"/></td>
                <td class="value"><input type="number" min="0" max="255" placeholder="0..255" id="bDay" name="bDay" value=""></td>
              </tr>
              <tr>
                <td class="value-name">bright. <img src="moon.svg" height="32px" style="vertical-align:middle; filter: invert(50%) sepia(50%) saturate(0%) hue-rotate(0deg) brightness(87%) contrast(156%);"/></td>
                <td class="value"><input type="number" min="0" max="255" placeholder="0..255" id="bNight" name="bNight" value=""></td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value"><button class="btn" onclick='toggleBrightness();doSend("ledCount:"+document.getElementById("ledCount").value+"bMin:"+document.getElementById("bMin").value+"bMax:"+document.getElementById("bMax").value+"offDelay:"+(Number(document.getElementById("offDelay").value)-4)+"bDay:"+Number(document.getElementById("bDay").value)+"bNight:"+Number(document.getElementById("bNight").value));'>Success</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="setup" class="config1 config2" style="display: inline-block;"">
          <table style=" width:100%; height:30px; border-collapse: collapse;">
            <tbody>
              <tr>
                <td class="value-name" width="250px">motion sensor</td>
                <td class="value"><label class="switch"><input id="MotionSensorSwitch" type="checkbox" onChange="toggleMotionSensor()"><span class="slider round"></span></label></td>
              </tr>
              <tr>
                <td class="value-name">motion off delay [s]</td>
                <td class="value"><input type="number" min="4" max="255" placeholder="4..255" id="offDelay" name="offDelay" value="`offDelay`" onchange='if (Number(this.value)<4){this.value=4;};doSend("ledCount:"+document.getElementById("ledCount").value+"bMin:"+document.getElementById("bMin").value+"bMax:"+document.getElementById("bMax").value+"offDelay:"+(Number(document.getElementById("offDelay").value)-4)+"bDay:"+Number(document.getElementById("bDay").value)+"bNight:"+Number(document.getElementById("bNight").value));'></td>
              </tr>
              <tr>
                <td class="value-name" width="200px">distance sensor</td>
                <td class="value"><label class="switch"><input id="DistanceSensorSwitch" type="checkbox" onChange="toggleDistanceSensor()"><span class="slider round"></span></label></td>
              </tr>
              <tr>
                <td class="value-name" width="200px">distance sensor</td>
                <td class="value"><button id="calibrationBtn" class="btn" onmousedown='doSend("calib:1");' onmouseup='doSend("calib:0");'>calibrate</button></td>
              </tr>
              <tr>
                <td class="value-name">&nbsp;</td><td class="value">&nbsp;</td>
              </tr>
              <tr>
                <td class="value-name">factory reset</td>
                <td class="value"><button class="btn" onclick='doSend("factoryReset"); alert("WiFiLed-`id` will now restart in WiFi AccessPoint mode!\n Connect your Wifi to this Accesspoint and configire SSID and Password!");'>start</button></td>
              <tr>
            </tbody>
          </table>
        </div>
        <div style="width: 360px;text-align: right;font-size: x-small; color:#888888">
          WiFiLed-`id` V`ver` by Daniel Warnicki
        </div>
      </td></tr>
    </table>
    <div class="dayNight" id="sun"><img src="sun.svg" height="32px" style="filter: invert(50%) sepia(50%) saturate(0%) hue-rotate(0deg) brightness(87%) contrast(156%);" /></div>
    <div class="dayNight" id="moon"><img src="moon.svg" height="32px" style="filter: invert(50%) sepia(50%) saturate(0%) hue-rotate(0deg) brightness(87%) contrast(156%);" /></div>
    <script type="text/javascript">
      //#########################################
      $(function () {
        $('#color-block').on('colorchange', function (e) {
          var color = $(this).wheelColorPicker('value');
          var h = $(this).wheelColorPicker('color').h;
          var s = $(this).wheelColorPicker('color').s;
          var v = $(this).wheelColorPicker('color').v;
          $('.rgbValue').text(color);
          $('.hValue').text(Math.round(h * 0xffff));
          $('.sValue').text(Math.round(s * 100) + '%');
          $('.bValue').text(Math.round(v * 100) + '%');
          if (boSendToDevice) {
            // change the Stripe color
            doSend("set=h:" + (h * 0xffff).toFixed(0) + "s:"+ (s * 0xff).toFixed(0) + "b:" + (v * 0xff).toFixed(0));
            if (day) {
              $("#bDay").prop('value', (v * 0xff).toFixed(0));   // set day brightness
            } else {
              $("#bNight").prop('value', (v * 0xff).toFixed(0)); // set night brigntness
            }
          } else {
            // do not update the device values
            boSendToDevice = true;
          }
        });
      });
    </script>
  </body>
</html>
